<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAHIA | The Royal Scriptorium</title>
    
    <!-- External Resources -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,wght@0,400;0,900;1,400&family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">

    <style>
        :root { 
            --royal-purple: #2d1b4e; 
            --accent-gold: #c5a059; 
            --canvas-bg: #faf9f6;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--canvas-bg);
            color: var(--royal-purple);
            overflow-x: hidden;
        }

        .serif { font-family: 'Bodoni Moda', serif; }

        /* Glassmorphism & Depth */
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 30px 60px -12px rgba(45, 27, 78, 0.12);
        }

        /* Gold Gradient Button */
        .btn-gold {
            background: linear-gradient(135deg, #c5a059 0%, #a37e3d 100%);
            color: white;
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            letter-spacing: 0.1em;
        }
        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(163, 126, 61, 0.5);
            filter: brightness(1.1);
        }

        /* Custom Input Styling */
        input, select {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(45, 27, 78, 0.1);
            transition: all 0.3s ease;
        }
        input:focus, select:focus {
            border-color: var(--accent-gold);
            background: white;
            outline: none;
            box-shadow: 0 0 0 4px rgba(197, 160, 89, 0.1);
        }

        .hidden { display: none !important; }

        /* Animations */
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.98) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .animate-view { animation: fadeInScale 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--canvas-bg); }
        ::-webkit-scrollbar-thumb { background: var(--accent-gold); border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Global Navigation -->
    <nav class="sticky top-0 z-50 w-full px-8 py-6 flex justify-between items-center backdrop-blur-md border-b border-black/5">
        <div class="flex items-center gap-4 cursor-pointer group" onclick="router.goto('home')">
            <div class="w-10 h-10 bg-black text-white rounded-full flex items-center justify-center font-black italic serif text-xl group-hover:bg-[#c5a059] transition-colors">Y</div>
            <span class="font-black uppercase tracking-[0.3em] text-sm">Yahia <span class="text-[#c5a059]">Collection</span></span>
        </div>
        
        <button id="admin-gate-btn" class="text-[10px] font-bold uppercase tracking-[0.2em] border-b-2 border-transparent hover:border-[#c5a059] transition-all pb-1">
            Portal Access
        </button>
    </nav>

    <!-- Main Workspace -->
    <main class="flex-grow flex items-center justify-center p-4 md:p-12">
        
        <!-- VIEW: HOME (The Atelier) -->
        <div id="view-home" class="animate-view w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-12 items-center">
            
            <!-- Customizer Side -->
            <div class="lg:col-span-7 space-y-10">
                <div class="space-y-2">
                    <h1 class="text-6xl md:text-8xl serif font-black tracking-tight leading-none">The Luxury <br><span class="italic text-[#c5a059]">Manuscript</span></h1>
                    <p class="text-gray-400 font-light max-w-md uppercase text-[10px] tracking-widest pt-4">Bespoke identity crafting for the modern academic elite.</p>
                </div>

                <div class="glass-card p-8 md:p-10 rounded-[2rem] space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-2">
                            <label class="text-[10px] uppercase font-black tracking-tighter text-gray-400">Patron Name</label>
                            <input type="text" id="order-name" placeholder="Full legal name" class="w-full p-4 rounded-xl text-lg font-medium">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] uppercase font-black tracking-tighter text-gray-400">Sigil Character</label>
                            <select id="order-letter" class="w-full p-4 rounded-xl text-lg font-bold appearance-none cursor-pointer"></select>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[10px] uppercase font-black tracking-tighter text-gray-400">Imperial Palette</label>
                        <div class="flex gap-4" id="color-picker">
                            <button data-color="#2d1b4e" class="w-12 h-12 rounded-full ring-2 ring-offset-2 ring-transparent bg-[#2d1b4e] border-2 border-white transition-all"></button>
                            <button data-color="#c5a059" class="w-12 h-12 rounded-full ring-2 ring-offset-2 ring-transparent bg-[#c5a059] border-2 border-white transition-all"></button>
                            <button data-color="#1a1a1a" class="w-12 h-12 rounded-full ring-2 ring-offset-2 ring-transparent bg-[#1a1a1a] border-2 border-white transition-all"></button>
                            <button data-color="#721c24" class="w-12 h-12 rounded-full ring-2 ring-offset-2 ring-transparent bg-[#721c24] border-2 border-white transition-all"></button>
                        </div>
                    </div>

                    <button id="order-submit-btn" class="w-full btn-gold py-6 rounded-2xl font-black uppercase text-xs shadow-2xl">
                        Authorize Order & Archive
                    </button>
                </div>
            </div>

            <!-- Preview Side -->
            <div class="lg:col-span-5 flex flex-col items-center">
                <div class="relative w-full aspect-[4/5] glass-card rounded-[3rem] overflow-hidden flex items-center justify-center p-12">
                    <div class="absolute inset-0 opacity-5 pointer-events-none" style="background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png')"></div>
                    <div id="preview-box" class="text-[18rem] md:text-[22rem] serif font-black leading-none drop-shadow-2xl transition-all duration-700" style="color: #2d1b4e">A</div>
                    <div class="absolute bottom-10 flex flex-col items-center opacity-30">
                        <div class="w-12 h-[1px] bg-black mb-4"></div>
                        <span class="text-[9px] uppercase tracking-[0.5em] font-bold">Authenticated Ed.</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: SUCCESS -->
        <div id="view-success" class="animate-view hidden w-full max-w-xl text-center space-y-8">
            <div class="w-32 h-32 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto shadow-inner">
                <i class="fa-solid fa-feather-pointed text-4xl"></i>
            </div>
            <div class="space-y-2">
                <h2 class="text-4xl font-black serif">Inscribed Successfully</h2>
                <p class="text-gray-400 text-sm">Your order has been logged into the Imperial Ledger.</p>
            </div>
            <div class="glass-card p-10 rounded-[2.5rem] border-2 border-dashed border-[#c5a059]">
                <span class="text-[10px] uppercase font-bold text-gray-400 tracking-widest">Tracking Reference</span>
                <h1 id="success-code" class="text-6xl font-black serif text-[#c5a059] mt-2">#Y-000</h1>
            </div>
            <button onclick="router.goto('home')" class="text-[10px] font-black uppercase tracking-[0.3em] hover:text-[#c5a059] transition-colors">Start New Commission</button>
        </div>

        <!-- VIEW: LOGIN -->
        <div id="view-login" class="animate-view hidden w-full max-w-md glass-card p-12 rounded-[2.5rem] text-center shadow-2xl">
            <div class="w-16 h-16 bg-black text-white rounded-2xl flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-key text-xl"></i>
            </div>
            <h2 class="text-2xl font-black uppercase tracking-widest mb-2">Gatekeeper</h2>
            <p class="text-gray-400 text-[10px] uppercase tracking-widest mb-8">Authorised Personnel Only</p>
            <input type="password" id="login-input" placeholder="ACCESS KEY" class="w-full p-5 rounded-2xl text-center tracking-[1em] text-xl font-bold mb-6">
            <button id="login-confirm-btn" class="w-full btn-gold py-5 rounded-2xl font-black uppercase text-xs">Unlock Ledger</button>
        </div>

        <!-- VIEW: DASHBOARD -->
        <div id="view-dashboard" class="animate-view hidden w-full max-w-7xl h-[85vh] flex flex-col space-y-6">
            <div class="flex justify-between items-end px-4">
                <div>
                    <h2 class="text-5xl font-black serif">Merchant <span class="text-[#c5a059]">Ledger</span></h2>
                    <p id="dash-stats" class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mt-2">Connecting to secure vault...</p>
                </div>
                <button onclick="router.goto('home')" class="bg-black text-white px-8 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-[#c5a059] transition-colors">Sign Out</button>
            </div>
            
            <div class="flex-grow glass-card rounded-[3rem] overflow-hidden border border-black/5 flex flex-col">
                <div class="overflow-auto flex-grow">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="border-b border-black/5">
                                <th class="p-8 text-[10px] uppercase font-black tracking-widest text-gray-400">Ref</th>
                                <th class="p-8 text-[10px] uppercase font-black tracking-widest text-gray-400">Identity</th>
                                <th class="p-8 text-[10px] uppercase font-black tracking-widest text-gray-400 text-center">Sigil</th>
                                <th class="p-8 text-[10px] uppercase font-black tracking-widest text-gray-400 text-right">Operation</th>
                            </tr>
                        </thead>
                        <tbody id="dash-order-list" class="divide-y divide-black/5">
                            <!-- Injected -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Dev Console -->
    <div id="sys-console" class="fixed bottom-0 left-0 w-full bg-black text-[#00ff41] p-2 text-[8px] font-mono opacity-0 hover:opacity-100 transition-opacity z-[100] h-8 overflow-hidden">
        <div id="console-inner">> System Ready.</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // CONFIGURATION
        const manualConfig = {
            apiKey: "AIzaSyDdtTa-kYLwkWdqw79w0M6Xm93OtBGWRWM",
            authDomain: "yahiashop.firebaseapp.com",
            projectId: "yahiashop",
            storageBucket: "yahiashop.firebasestorage.app",
            messagingSenderId: "776328811720",
            appId: "1:776328811720:web:e69431d24c8c0d81c081fd",
            measurementId: "G-V6VBBH14RY"
        };

        const config = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : manualConfig;
        const appIDStr = typeof __app_id !== 'undefined' ? __app_id : 'yahiashop-prod';
        
        const fApp = initializeApp(config);
        const auth = getAuth(fApp);
        const db = getFirestore(fApp);
        
        // Path adjusted for standard security compliance
        const COLLECTION_REF = `artifacts/${appIDStr}/public/data/orders`;

        let activeUser = null;
        let realtimeUnsubscribe = null;
        let selectedColor = "#2d1b4e";

        // Auth
        signInAnonymously(auth).catch((e) => console.error("Cloud Access Denied:", e.message));
        onAuthStateChanged(auth, u => { activeUser = u; });

        // Router
        window.router = {
            goto: (viewId) => {
                document.querySelectorAll('[id^="view-"]').forEach(v => v.classList.add('hidden'));
                document.getElementById('view-' + viewId).classList.remove('hidden');
                if (viewId === 'dashboard') router.syncLedger();
                else if (realtimeUnsubscribe) { realtimeUnsubscribe(); realtimeUnsubscribe = null; }
            },
            syncLedger: () => {
                const listEl = document.getElementById('dash-order-list');
                const statsEl = document.getElementById('dash-stats');
                if (realtimeUnsubscribe) realtimeUnsubscribe();
                realtimeUnsubscribe = onSnapshot(collection(db, COLLECTION_REF), (snap) => {
                    listEl.innerHTML = '';
                    statsEl.innerText = `${snap.size} ARCHIVED ENTRIES`;
                    snap.forEach(d => {
                        const item = d.data();
                        const tr = document.createElement('tr');
                        tr.className = "hover:bg-white/50 transition-colors";
                        tr.innerHTML = `
                            <td class="p-8 font-mono font-bold text-xs">#${item.code}</td>
                            <td class="p-8">
                                <div class="font-black serif text-xl">${item.name}</div>
                                <div class="text-[9px] uppercase tracking-widest text-gray-400 mt-1">${new Date(item.timestamp).toDateString()}</div>
                            </td>
                            <td class="p-8 text-center">
                                <span class="serif font-black text-4xl" style="color:${item.color}">${item.letter}</span>
                            </td>
                            <td class="p-8 text-right">
                                <button onclick="window.fulfillOrder('${d.id}')" class="text-[10px] font-black uppercase tracking-widest text-red-400 hover:text-red-600">Archive</button>
                            </td>
                        `;
                        listEl.appendChild(tr);
                    });
                }, (err) => {
                    console.error("Firestore error:", err);
                    statsEl.innerText = "Error syncing with vault.";
                });
            }
        };

        window.fulfillOrder = async (id) => { 
            if(confirm("Permanently archive this commission?")) await deleteDoc(doc(db, COLLECTION_REF, id)); 
        };

        const init = () => {
            const letterInput = document.getElementById('order-letter');
            const nameInput = document.getElementById('order-name');
            const previewText = document.getElementById('preview-box');
            const colorButtons = document.querySelectorAll('#color-picker button');

            "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l => {
                const opt = document.createElement('option');
                opt.value = l; opt.innerText = "Manuscript " + l;
                letterInput.appendChild(opt);
            });

            letterInput.onchange = () => { previewText.innerText = letterInput.value; };
            
            colorButtons.forEach(btn => {
                btn.onclick = () => {
                    colorButtons.forEach(b => b.classList.remove('ring-black', 'scale-110'));
                    btn.classList.add('ring-black', 'scale-110');
                    selectedColor = btn.dataset.color;
                    previewText.style.color = selectedColor;
                };
            });
            colorButtons[0].click();

            document.getElementById('admin-gate-btn').onclick = () => router.goto('login');
            
            document.getElementById('order-submit-btn').onclick = async () => {
                if (!nameInput.value.trim()) return alert("Provide a patron identity.");
                const code = Math.random().toString(36).substr(2, 5).toUpperCase();
                try {
                    await addDoc(collection(db, COLLECTION_REF), {
                        code, name: nameInput.value, letter: letterInput.value, color: selectedColor, timestamp: Date.now()
                    });
                    document.getElementById('success-code').innerText = "#" + code;
                    router.goto('success');
                    nameInput.value = '';
                } catch (e) { 
                    console.error(e);
                    alert("Vault Connection Error. Check your internet or Firebase Rules."); 
                }
            };

            document.getElementById('login-confirm-btn').onclick = () => {
                if (document.getElementById('login-input').value === 'MADMIN') {
                    router.goto('dashboard');
                    document.getElementById('login-input').value = '';
                } else { alert("ACCESS DENIED"); }
            };

            router.goto('home');
        };

        window.onload = init;
    </script>
</body>
</html>
